---
import Layout from '../../layouts/Layout.astro';

// Función requerida pero vacía para build estático
export async function getStaticPaths() {
  return [];
}

const { id } = Astro.params;
---

<Layout title="Estación Terrena">
  <div id="station-view">
    <div class="loading-state">
      <p>Cargando información de la estación...</p>
    </div>
  </div>

  <script is:inline>
    // Carga diferida de Firebase solo en el cliente
    async function loadStation() {
      try {
        const { initializeApp } = await import('firebase/app');
        const { getFirestore, doc, getDoc } = await import('firebase/firestore');
        
        const firebaseConfig = {
          apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY,
          authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN,
          projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID,
          storageBucket: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET,
          messagingSenderId: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
          appId: import.meta.env.PUBLIC_FIREBASE_APP_ID
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const stationId = window.location.pathname.split('/').pop();
        const docRef = doc(db, 'stations', stationId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
          window.location.href = '/404';
          return;
        }
        
        const station = { id: docSnap.id, ...docSnap.data() };
        renderStation(station);
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('station-view').innerHTML = `
          <div class="error-state">
            <p>Error al cargar la estación</p>
            <button onclick="window.location.reload()">Reintentar</button>
          </div>
        `;
      }
    }

    function renderStation(station) {
      document.getElementById('station-view').innerHTML = `
        <div class="station-detail">
          <h1>${station.name}</h1>
          <p class="description">${station.description}</p>
          <!-- Añade más detalles de la estación aquí -->
        </div>
      `;
    }

    // Iniciar carga cuando el DOM esté listo
    if (document.readyState !== 'loading') {
      loadStation();
    } else {
      document.addEventListener('DOMContentLoaded', loadStation);
    }
  </script>

  <style>
    .station-detail {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }
    .loading-state, .error-state {
      text-align: center;
      padding: 3rem;
    }
    .error-state button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</Layout>