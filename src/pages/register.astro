---
import Layout from '../layouts/Layout.astro';

const isBrowser = typeof window !== 'undefined';
const isLoggedIn = isBrowser ? !!localStorage.getItem('celestia_currentUser') : false;

if (isBrowser && isLoggedIn) {
  window.location.href = '/dashboard';
}
---

<Layout title="Registrar Estaci√≥n - CelestiaCom">
  <main class="auth-container">
    <form id="register-form" class="auth-form">
      <h2>Registrar Estaci√≥n</h2>
      
      <div class="form-group">
        <label for="register-email">Email</label>
        <input 
          type="email" 
          id="register-email" 
          required 
          class="form-input"
        />
      </div>
      
      <div class="form-group">
        <label for="register-password">Contrase√±a</label>
        <input 
          type="password" 
          id="register-password" 
          required 
          class="form-input"
        />
      </div>
      
      <div class="form-group">
        <label for="register-estacion">Nombre de Estaci√≥n</label>
        <input 
          type="text" 
          id="register-estacion" 
          required 
          class="form-input"
        />
      </div>
      
      <button type="submit" class="submit-button">
        Registrar
      </button>
      
      <p class="auth-link">¬øYa tienes cuenta? <a href="/login">Inicia sesi√≥n</a></p>
    </form>
  </main>
</Layout>

<style>
  .auth-container {
    max-width: 500px;
    margin: 2rem auto;
    padding: 2rem;
    background: var(--azul-oscuro);
    border-radius: 8px;
    border: 1px solid var(--azul-medio);
  }

  .auth-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .form-input {
    padding: 0.75rem;
    background: var(--azul-profundo);
    border: 1px solid var(--azul-medio);
    border-radius: 4px;
    color: var(--texto-claro);
    font-size: 1rem;
    width: 100%;
  }
  
  .submit-button {
    padding: 0.75rem;
    background: var(--acento-verde);
    color: var(--azul-profundo);
    border: none;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
  }
  
  .submit-button:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  .auth-link {
    text-align: center;
    color: var(--texto-secundario);
  }
  
  .auth-link a {
    color: var(--acento-verde);
    text-decoration: none;
  }
  
  .auth-link a:hover {
    text-decoration: underline;
  }
</style>

<script>
  // Manejar registro
  document.getElementById('register-form').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    const estacion = document.getElementById('register-estacion').value;

    if (!email || !password || !estacion) {
      alert('‚ö†Ô∏è Todos los campos son obligatorios');
      return;
    }

    const users = JSON.parse(localStorage.getItem('celestia_users') || []);

    // L√≠mite de 10 usuarios
    if (users.length >= 10) {
      alert('üö´ L√≠mite de 10 usuarios alcanzado');
      return;
    }

    // Verificar email existente
    if (users.some(u => u.email === email)) {
      alert('‚ùå Este email ya est√° registrado');
      return;
    }

    // Crear usuario
    const newUser = {
      id: Date.now(),
      email,
      password,
      estacion,
      fechaRegistro: new Date().toISOString()
    };

    users.push(newUser);
    localStorage.setItem('celestia_users', JSON.stringify(users));
    localStorage.setItem('celestia_currentUser', JSON.stringify(newUser));

    alert(`‚úÖ Estaci√≥n "${estacion}" registrada!`);
    window.location.href = '/dashboard';
  });
</script>